##Loading library and dataset
install.packages("tidyverse")

library(tidyverse)
library(lubridate)
library(ggplot2)

superstore <- read.csv("https://raw.githubusercontent.com/safesit23/INT214-Statistics/main/datasets/superstore_sales.csv")


##Explore the dataset
View(superstore)
glimpse(superstore)




#Part 2: Learning function from Tidyverse

#library(lubridate) // ????????????????????????????????????????????????????????????????????????????????????????????????????????? ????????????


superstore %>% select(Order.Date) %>% filter(superstore$Row.ID == 1) %>% dmy()






#Part 3: Transform data with dplyr and finding insight the data

#1.?????????????????????????????????????????? sale ???????????????????????????

superstore %>% select(Product.Name, Sales) %>% group_by(Product.Name) %>% summarise(Sales = sum(Sales)) %>% filter(Sales == max(Sales))

#2. ?????????????????????????????????????????????????????????????????????????????????????????????????????? ????????????????????????????????????????????????????????????????????????????????????
superstore %>% group_by(City) %>% summarise(Sales = sum(Sales)) %>% print(n = 1000)
superstore %>% group_by(City) %>% summarise(Sales = sum(Sales)) %>% filter(Sales == max(Sales))

#3. ???????????????????????????????????????????????????????????? (??????????????????)

superstore %>% summarise(AllCustomer = n_distinct(Customer.Name))




#4. ??????????????????????????? ???????????????????????????????????????????????????????????????????????????????????????

##using lubridate


superstore  %>% mutate(year = year(dmy(Order.Date))) %>% group_by(year) %>% summarise(mean = mean(Sales))



#5.?????????????????????????????????????????????????????? sub-category

superstore %>% group_by(Sub.Category) %>% summarise(TotalProduct = n_distinct(Product.Name))

#6. ?????????????????????????????????????????????????????????????????????????????????????????????????????? ????????????????????????????????????????????????????????????????????????????????????????????????????????????

superstore %>% group_by(Region) %>% summarise(NumOfCustomer = n_distinct(Customer.Name), SaleofRegion = sum(Sales))


#Part 4: Visualization with GGplot2
##1
product_sub <- superstore %>% group_by(Sub.Category) %>% summarise(TotalProduct = n_distinct(Product.Name))

##ggplot2

product_sub_plot <- product_sub %>% ggplot(aes(x = Sub.Category, y = TotalProduct)) + geom_bar(stat="identity", fill="steelblue") +
                    geom_text(aes(label=TotalProduct), vjust=1.6, color = "white", size = 3.5)


product_sub_plot + ggtitle("Number of Product each Sub-category") + xlab("Sub-Category") + ylab("Number of Product")

##2
product_year <- superstore  %>% mutate(year = year(dmy(Order.Date))) %>% group_by(year) %>% summarise(mean = mean(Sales))


##ggplot2
product_year_plot <- product_year %>% ggplot(aes(x = year, y = mean)) + geom_line(size = 1, linetype ="dashed", color = "blue") + geom_point(color = "red" , size = 2)
                                            

product_year_plot + ggtitle("Average sales for each year") + xlab("Years") + ylab("Sales average")
